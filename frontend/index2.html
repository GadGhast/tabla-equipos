<!DOCTYPE html>

<html lang="es">

<head>

    <meta charset="UTF-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Tabla Dinámica de Equipos con Sincronización</title>

    <style>

        body {

            font-family: Arial, sans-serif;

            display: flex;

            justify-content: center;

            align-items: center;

            height: 100vh;

            margin: 0;

            background-color: #f4f4f9;

        }

        table {

            width: 70%;

            border-collapse: collapse;

            margin: 20px 0;

            font-size: 18px;

            text-align: left;

        }

        table th, table td {

            padding: 12px;

            border: 1px solid #ddd;

        }

        table th {

            background-color: #ffa726;

            color: black;

            text-transform: uppercase;

            text-align: center;

        }

        tbody tr td:first-child {

            background-color: #ffcc80;

            color: black;

            font-weight: bold;

            text-align: center;

            position: sticky;

            left: 0;

            z-index: 1;

        }

        table tr:nth-child(even) {

            background-color: #f2f2f2;

        }

        table tr:hover {

            background-color: #ddd;

        }

    </style>

</head>

<body>



<table id="countriesTable">

    <thead>

        <tr>

            <th>Rank</th>

            <th>Equipo</th>

            <th>Puntos</th>

        </tr>

    </thead>

    <tbody>

        <tr><td>1</td><td>T1</td><td data-value="0">0</td></tr>

        <tr><td>2</td><td>GenG</td><td data-value="0">0</td></tr>

        <tr><td>3</td><td>BiliBili</td><td data-value="0">0</td></tr>

        <tr><td>4</td><td>KOI</td><td data-value="0">0</td></tr>

        <tr><td>5</td><td>G2</td><td data-value="0">0</td></tr>

        <tr><td>6</td><td>Fnatic</td><td data-value="0">0</td></tr>

        <tr><td>7</td><td>Heretics</td><td data-value="0">0</td></tr>

        <tr><td>8</td><td>Astralis</td><td data-value="0">0</td></tr>

        <tr><td>9</td><td>Barça</td><td data-value="0">0</td></tr>

        <tr><td>10</td><td>Madrid</td><td data-value="0">0</td></tr>

    </tbody>

</table>



<script>

const API_URL = "http://localhost:3000/equipos";

let countries = [];



async function fetchData() {

    try {

        const res = await fetch(API_URL);

        countries = await res.json();

        updateTable();

        sortTable();

    } catch (err) {

        console.error("Error al obtener datos del servidor:", err);

    }

}



async function sendData() {

    try {

        await fetch(API_URL, {

            method: "POST",

            headers: { "Content-Type": "application/json" },

            body: JSON.stringify(countries)

        });

    } catch (err) {

        console.error("Error al enviar datos al servidor:", err);

    }

}



function formatNumber(number) {

    return number.toLocaleString('es-ES');

}



function updateTable() {

    const tbody = document.querySelector("#countriesTable tbody");

    countries.forEach(country => {

        const row = [...tbody.rows].find(r => r.cells[1].innerText === country.name);

        if (row) {

            row.cells[2].setAttribute("data-value", country.value);

            row.cells[2].innerText = formatNumber(country.value);

        }

    });

}



function fluctuateValue(country) {

    const change = Math.floor(Math.random() * 21) - 10;

    country.value += change;

    if (Math.random() < 0.6) {

        country.value += Math.floor(Math.random() * 5);

    }

}



function sortTable() {

    const tbody = document.querySelector("#countriesTable tbody");

    const rows = Array.from(tbody.rows);



    rows.sort((a, b) => {

        const valA = parseInt(a.cells[2].getAttribute('data-value'));

        const valB = parseInt(b.cells[2].getAttribute('data-value'));

        return valB - valA;

    });



    rows.forEach((row, index) => {

        row.cells[0].innerText = index + 1;

        tbody.appendChild(row);

    });

}



setInterval(() => {

    countries.forEach(fluctuateValue);

    updateTable();

    sortTable();

    sendData();

}, 500);



fetchData();

</script>



</body>

  </html>
